<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸŒŒ/â˜€ï¸ XRP æŠ•ã’éŠ­ã‚¢ãƒ—ãƒª</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    /* CSS Variables for theming */
    :root {
      /* Night Mode Defaults */
      --bg-color: #1a1a2e; /* Dark Blue */
      --container-bg: #16213e; /* Slightly lighter dark blue */
      --text-color: #e0e0e0; /* Light Gray */
      --accent-color-1: #0f3460; /* Darker accent */
      --accent-color-2: #e94560; /* Reddish pink (for highlights/errors) */
      --primary-button-bg: #4a90e2; /* Blue */
      --primary-button-hover: #357bd8; /* Darker Blue */
      --success-color: #5cb85c; /* Green */
      --info-color: #3f72af; /* Muted blue */
      --border-color: #0c183d; /* Very dark border */
      --input-bg: #283a5e; /* Darker blue for input */
      --qr-border: #8d9bb5; /* Light muted blue */
      --hr-color: #0c183d;
      --note-bg: #3c4c70; /* Memo background */
      --note-border: #5a6b90; /* Memo border */
      --note-text: #ffffff; /* Memo text color */
      --pin-input-bg: #22304f;
      --pin-input-border: #405a80;
      --note-line-color: #5c6e91; /* Memo line color */
      --copy-icon-color: #bbbbbb; /* Copy icon color */

      /* Day Mode Overrides (initially hidden) */
      --day-bg-color: #f0f2f5;
      --day-container-bg: #ffffff;
      --day-text-color: #333333;
      --day-accent-color-1: #e0f7fa;
      --day-accent-color-2: #ff7043; /* Orange for highlights/errors */
      --day-primary-button-bg: #2196f3; /* Brighter Blue */
      --day-primary-button-hover: #1976d2;
      --day-success-color: #4caf50;
      --day-info-color: #03a9f4;
      --day-border-color: #e0e0e0;
      --day-input-bg: #f9f9f9;
      --day-qr-border: #9e9e9e;
      --day-hr-color: #e0e0e0;
      --day-note-bg: #ffffff; /* Day memo background */
      --day-note-border: #d0d0d0; /* Day memo border */
      --day-note-text: #333333; /* Day memo text */
      --day-pin-input-bg: #f5f5f5;
      --day-pin-input-border: #cccccc;
      --day-note-line-color: #e0e0e0; /* Day memo line color */
      --day-copy-icon-color: #666666; /* Copy icon color */
    }

    /* Day Mode styles */
    body.day-mode {
      --bg-color: var(--day-bg-color);
      --container-bg: var(--day-container-bg);
      --text-color: var(--day-text-color);
      --accent-color-1: var(--day-accent-color-1);
      --accent-color-2: var(--day-accent-color-2);
      --primary-button-bg: var(--day-primary-button-bg);
      --primary-button-hover: var(--day-primary-button-hover);
      --success-color: var(--day-success-color);
      --info-color: var(--day-info-color);
      --border-color: var(--day-border-color);
      --input-bg: var(--day-input-bg);
      --qr-border: var(--day-qr-border);
      --hr-color: var(--day-hr-color);
      --note-bg: var(--day-note-bg);
      --note-border: var(--day-note-border);
      --note-text: var(--day-note-text);
      --pin-input-bg: var(--day-pin-input-bg);
      --pin-input-border: var(--day-pin-input-border);
      --note-line-color: var(--day-note-line-color);
      --copy-icon-color: var(--day-copy-icon-color);
    }

    body {
      font-family: 'Orbitron', sans-serif; /* Futuristic font */
      margin: 0;
      padding: 20px;
      background-color: var(--bg-color);
      display: flex;
      justify-content: center;
      min-height: 100vh; /* å°‘ãªãã¨ã‚‚ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã®é«˜ã• */
      color: var(--text-color);
      position: relative;
      transition: background-color 0.5s ease;
      overflow-y: auto; /* å¿…è¦ã«å¿œã˜ã¦ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã™ã‚‹ */
      line-height: 1.4; /* å…¨ä½“ã®è¡Œé–“ã‚’è©°ã‚ã‚‹ */
    }

    /* Background animation for a dynamic feel (Night mode only) */
    body:not(.day-mode)::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, #0c183d, #1a1a2e, #0c183d);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      z-index: -1;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container {
      background-color: var(--container-bg);
      padding: 25px; /* å…¨ä½“çš„ã«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¸›ã‚‰ã™ */
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      text-align: center;
      max-width: 550px;
      width: 100%;
      border: 2px solid var(--border-color);
      position: relative;
      animation: fadeIn 1s ease-out;
      transition: background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;
      margin: auto; /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒçŸ­ãã¦ã‚‚ä¸­å¤®ã«é…ç½® */
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      color: var(--primary-button-bg);
      margin-bottom: 20px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      font-size: 2.2em; /* æ–‡å­—ã‚’å°ã•ã */
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px; /* ã‚®ãƒ£ãƒƒãƒ—ã‚’æ¸›ã‚‰ã™ */
      text-shadow: 0 0 10px rgba(74, 144, 226, 0.5); /* Glowing effect */
      transition: color 0.5s ease, text-shadow 0.5s ease;
    }
    body.day-mode h1 {
      text-shadow: none; /* No glow in day mode */
    }

    h2 {
      color: var(--text-color);
      margin-top: 25px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      margin-bottom: 15px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      font-size: 1.6em; /* æ–‡å­—ã‚’å°ã•ã */
      text-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
      transition: color 0.5s ease, text-shadow 0.5s ease;
    }
    body.day-mode h2 {
      text-shadow: none;
    }

    p {
      color: var(--text-color);
      line-height: 1.5; /* è¡Œé–“ã‚’èª¿æ•´ */
      font-size: 0.95em; /* æ–‡å­—ã‚’å°ã•ã */
      margin-bottom: 10px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’è©°ã‚ã‚‹ */
      transition: color 0.5s ease;
    }

    .streamer-info p {
      margin-bottom: 15px;
    }

    .xrpl-address-wrapper {
      position: relative;
      display: flex; /* flexboxã§è¦ç´ ã‚’æ¨ªä¸¦ã³ã«ã™ã‚‹ */
      align-items: center; /* å‚ç›´æ–¹å‘ä¸­å¤®æƒãˆ */
      gap: 5px; /* ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã¨ã‚¢ã‚¤ã‚³ãƒ³ã®é–“ã«éš™é–“ */
      margin-bottom: 15px;
    }

    .xrpl-address {
      font-family: 'Share Tech Mono', monospace;
      background-color: var(--input-bg);
      padding: 10px 12px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¸›ã‚‰ã™ */
      border-radius: 8px;
      font-size: 0.9em; /* æ–‡å­—ã‚’å°ã•ã */
      color: var(--text-color);
      word-break: break-all;
      border: 1px solid var(--border-color);
      width: 100%; /* è¦ªè¦ç´ ã®å¹…ã„ã£ã±ã„ã« */
      flex-grow: 1; /* ã‚¤ãƒ³ãƒ—ãƒƒãƒˆãŒåˆ©ç”¨å¯èƒ½ãªã‚¹ãƒšãƒ¼ã‚¹ã‚’åŸ‹ã‚ã‚‹ */
      transition: all 0.3s ease;
    }

    .xrpl-address:focus {
      outline: none;
      border-color: var(--primary-button-bg);
      box-shadow: 0 0 8px rgba(74, 144, 226, 0.6);
    }
    body.day-mode .xrpl-address:focus {
      box-shadow: 0 0 8px rgba(33, 150, 243, 0.6);
    }

    .copy-icon-button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 5px; /* ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ç¯„å›² */
      color: var(--copy-icon-color);
      font-size: 1.3em; /* ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚ºã‚’èª¿æ•´ */
      transition: color 0.3s ease, transform 0.2s ease;
      position: absolute; /* ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã®å³ç«¯ã«é…ç½® */
      right: 10px;
    }

    .copy-icon-button:hover {
      color: var(--primary-button-bg);
      transform: scale(1.1);
    }
    .copy-icon-button:active {
      transform: scale(0.9);
    }

    .address-buttons {
      display: flex;
      gap: 10px; /* ãƒœã‚¿ãƒ³é–“ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’è©°ã‚ã‚‹ */
      justify-content: center;
      margin-bottom: 10px; /* ä¸‹ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’è©°ã‚ã‚‹ */
    }

    .connect-button {
      background-color: var(--primary-button-bg);
      color: white;
      border: none;
      padding: 8px 15px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¸›ã‚‰ã™ */
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em; /* æ–‡å­—ã‚’å°ã•ã */
      font-family: 'Orbitron', sans-serif;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      flex-grow: 1; /* ãƒœã‚¿ãƒ³ã‚’æ¨ªã«åºƒã’ã‚‹ */
    }

    .connect-button:hover {
      background-color: var(--primary-button-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
    }

    .copy-status {
      color: var(--success-color);
      font-weight: bold;
      margin-top: 10px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      font-size: 0.85em; /* æ–‡å­—ã‚’å°ã•ã */
      opacity: 0; /* åˆæœŸéè¡¨ç¤º */
      transition: opacity 0.5s ease-out; /* ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    }
    .copy-status.show {
      opacity: 1;
    }

    .input-group {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      gap: 10px; /* ã‚®ãƒ£ãƒƒãƒ—ã‚’æ¸›ã‚‰ã™ */
    }

    .input-group input[type="number"] {
      padding: 10px 12px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¸›ã‚‰ã™ */
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 1.1em; /* æ–‡å­—ã‚’å°ã•ã */
      width: 120px; /* å¹…ã‚’èª¿æ•´ */
      text-align: right;
      background-color: var(--input-bg);
      color: var(--text-color);
      font-family: 'Share Tech Mono', monospace;
      transition: all 0.3s ease;
    }

    .input-group input[type="number"]:focus {
      outline: none;
      border-color: var(--primary-button-bg);
      box-shadow: 0 0 8px rgba(74, 144, 226, 0.6);
    }
    body.day-mode .input-group input[type="number"]:focus {
      box-shadow: 0 0 8px rgba(33, 150, 243, 0.6);
    }

    .input-group span {
      font-size: 1.1em; /* æ–‡å­—ã‚’å°ã•ã */
      font-weight: bold;
      color: var(--primary-button-bg);
      text-shadow: 0 0 5px rgba(74, 144, 226, 0.3);
      transition: color 0.5s ease, text-shadow 0.5s ease;
    }
    body.day-mode .input-group span {
      text-shadow: none;
    }

    .tip-button {
      background-color: var(--accent-color-2); /* Reddish pink for action */
      color: white;
      border: none;
      padding: 12px 25px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¸›ã‚‰ã™ */
      border-radius: 10px;
      font-size: 1.2em; /* æ–‡å­—ã‚’å°ã•ã */
      cursor: pointer;
      font-family: 'Orbitron', sans-serif;
      transition: all 0.3s ease;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
      letter-spacing: 0.5px; /* æ–‡å­—é–“éš”ã‚’è©°ã‚ã‚‹ */
    }

    .tip-button:hover {
      background-color: #d63d58; /* Darker pink */
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    }
    body.day-mode .tip-button:hover {
      background-color: #f5511e; /* Darker orange */
    }


    .tip-button:disabled {
      background-color: #666;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .message {
      margin-top: 20px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      padding: 10px 15px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¸›ã‚‰ã™ */
      border-radius: 10px;
      font-weight: bold;
      font-size: 1em; /* æ–‡å­—ã‚’å°ã•ã */
      transition: all 0.5s ease;
    }

    .message.info {
      background-color: rgba(63, 114, 175, 0.2);
      color: var(--info-color);
      border: 1px solid var(--info-color);
    }
    body.day-mode .message.info {
      background-color: rgba(3, 169, 244, 0.1);
    }

    .message.success {
      background-color: rgba(92, 184, 92, 0.2);
      color: var(--success-color);
      border: 1px solid var(--success-color);
    }
    body.day-mode .message.success {
      background-color: rgba(76, 175, 80, 0.1);
    }

    .qr-code-area {
      margin-top: 25px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      padding: 15px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¸›ã‚‰ã™ */
      background-color: var(--accent-color-1);
      border-radius: 12px;
      border: 2px dashed var(--qr-border);
      display: none; /* Initially hidden */
      opacity: 0;
      transform: scale(0.9);
      transition: opacity 0.5s ease, transform 0.5s ease, background-color 0.5s ease, border-color 0.5s ease;
    }

    .qr-code-area.show {
      opacity: 1;
      transform: scale(1);
    }

    .qr-image {
      width: 180px; /* QRã‚³ãƒ¼ãƒ‰ã‚’å°ã•ã */
      height: 180px;
      margin: 15px auto; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      display: block;
      border: 6px solid white; /* æ ç·šã‚’ç´°ã */
      border-radius: 5px;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
      transition: border-color 0.5s ease, box-shadow 0.5s ease;
    }
    
    .qr-code-area p {
      font-size: 0.85em; /* æ–‡å­—ã‚’å°ã•ã */
      line-height: 1.3;
      margin-bottom: 8px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’è©°ã‚ã‚‹ */
    }

    .qr-code-area p:last-of-type {
        margin-top: 15px;
    }

    .open-xaman-button {
      background-color: var(--success-color); /* Green for direct action */
      color: white;
      border: none;
      padding: 10px 20px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¸›ã‚‰ã™ */
      border-radius: 8px;
      font-size: 1em; /* æ–‡å­—ã‚’å°ã•ã */
      cursor: pointer;
      font-family: 'Orbitron', sans-serif;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      margin-top: 10px; /* ã‚¹ãƒšãƒ¼ã‚¹ã‚’è©°ã‚ã‚‹ */
    }
    .open-xaman-button:hover {
      background-color: #4CAF50; /* Darker green */
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
    }
    body.day-mode .open-xaman-button {
      background-color: var(--day-success-color);
    }
    body.day-mode .open-xaman-button:hover {
      background-color: #388e3c;
    }

    hr {
      border: none;
      border-top: 1px dashed var(--hr-color);
      margin: 30px 0; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      transition: border-color 0.5s ease;
    }

    /* Small glowing effect on elements on hover */
    .container button:not(.tip-button):hover,
    .container input:not([type="number"]):hover {
      box-shadow: 0 0 15px rgba(74, 144, 226, 0.8);
    }
    body.day-mode .container button:not(.tip-button):hover,
    body.day-mode .container input:not([type="number"]):hover {
      box-shadow: 0 0 15px rgba(33, 150, 243, 0.8);
    }

    /* Theme Toggle Switch */
    .theme-switch-wrapper {
      display: flex;
      align-items: center;
      justify-content: flex-end; /* Align to the right */
      margin-bottom: 15px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      gap: 8px; /* ã‚®ãƒ£ãƒƒãƒ—ã‚’æ¸›ã‚‰ã™ */
    }
    .theme-switch-wrapper span {
      font-size: 0.85em; /* æ–‡å­—ã‚’å°ã•ã */
      color: var(--text-color);
      transition: color 0.5s ease;
    }
    .theme-switch {
      display: inline-block;
      height: 24px; /* é«˜ã•ã‚’å°ã•ã */
      position: relative;
      width: 44px; /* å¹…ã‚’å°ã•ã */
    }
    .theme-switch input {
      display:none;
    }
    .slider {
      background-color: var(--accent-color-1);
      bottom: 0;
      cursor: pointer;
      left: 0;
      position: absolute;
      right: 0;
      top: 0;
      transition: .4s;
      border-radius: 34px;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
    }
    body.day-mode .slider {
      background-color: #ccc;
    }
    .slider:before {
      background-color: #fff;
      bottom: 3px; /* ä½ç½®èª¿æ•´ */
      content: "";
      height: 18px; /* ã‚µã‚¤ã‚ºã‚’å°ã•ã */
      left: 3px; /* ä½ç½®èª¿æ•´ */
      position: absolute;
      transition: .4s;
      width: 18px; /* ã‚µã‚¤ã‚ºã‚’å°ã•ã */
      border-radius: 50%;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    input:checked + .slider {
      background-color: var(--primary-button-bg);
    }
    input:checked + .slider:before {
      transform: translateX(20px); /* ã‚¹ãƒ©ã‚¤ãƒ‰è·é›¢èª¿æ•´ */
    }

    /* PIN and Memo Section */
    .memo-section {
      margin-top: 25px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      padding: 20px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¸›ã‚‰ã™ */
      background-color: var(--container-bg);
      border-radius: 12px;
      border: 1px solid var(--border-color);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      text-align: left;
      display: none; /* Initially hidden */
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease, background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;
    }
    .memo-section.show {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .memo-section h3 {
      color: var(--primary-button-bg);
      font-size: 1.3em; /* æ–‡å­—ã‚’å°ã•ã */
      margin-bottom: 15px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      text-align: center;
      transition: color 0.5s ease;
    }

    .pin-input-group {
      display: flex;
      justify-content: center;
      margin-bottom: 15px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
    }
    .pin-input-group input {
      width: 120px; /* å¹…ã‚’å°ã•ã */
      padding: 8px 12px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¸›ã‚‰ã™ */
      font-size: 1em; /* æ–‡å­—ã‚’å°ã•ã */
      border: 1px solid var(--pin-input-border);
      border-radius: 8px;
      background-color: var(--pin-input-bg);
      color: var(--text-color);
      text-align: center;
      font-family: 'Share Tech Mono', monospace;
      transition: all 0.3s ease;
    }
    .pin-input-group input:focus {
      outline: none;
      border-color: var(--primary-button-bg);
      box-shadow: 0 0 8px rgba(74, 144, 226, 0.6);
    }
    body.day-mode .pin-input-group input:focus {
      box-shadow: 0 0 8px rgba(33, 150, 243, 0.6);
    }

    .pin-button {
      background-color: var(--primary-button-bg);
      color: white;
      border: none;
      padding: 8px 20px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¸›ã‚‰ã™ */
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em; /* æ–‡å­—ã‚’å°ã•ã */
      font-family: 'Orbitron', sans-serif;
      transition: all 0.3s ease;
      margin-top: 10px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      width: 100%;
    }
    .pin-button:hover {
      background-color: var(--primary-button-hover);
      transform: translateY(-2px);
    }
    .pin-button:disabled {
      background-color: #666;
      cursor: not-allowed;
      transform: none;
    }
    .pin-status {
      font-size: 0.8em; /* æ–‡å­—ã‚’å°ã•ã */
      margin-top: 8px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      text-align: center;
      color: var(--accent-color-2);
      transition: color 0.5s ease;
    }

    /* Memo input styling (iPhone Notes inspired) */
    .memo-input-container {
      margin-top: 20px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’æ¸›ã‚‰ã™ */
      position: relative;
      display: none; /* Hidden until PIN is correct */
      opacity: 0;
      transform: scaleY(0);
      transform-origin: top;
      transition: opacity 0.5s ease, transform 0.5s ease;
      border: 1px solid var(--note-border); /* Outer border for the memo area */
      border-radius: 10px;
      background-color: var(--note-bg);
      padding: 10px; /* Padding inside the memo box */
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
      overflow: hidden; /* Ensure lines don't bleed outside */
    }
    .memo-input-container.show {
      display: block;
      opacity: 1;
      transform: scaleY(1);
    }

    .memo-input {
      width: 100%; /* Take full width of its container's padding */
      min-height: 120px; /* min-heightã‚’èª¿æ•´ */
      padding: 5px; /* Adjust padding to make lines align better */
      border: none; /* No individual border for the textarea */
      background-color: var(--note-bg);
      color: var(--note-text);
      font-family: 'Roboto', sans-serif; /* More standard font for notes */
      font-size: 0.95em; /* æ–‡å­—ã‚’å°ã•ã */
      resize: vertical;
      line-height: 1.7em; /* Space for lines (å°ã•ã) */
      box-shadow: none; /* No individual box-shadow */
      outline: none; /* No outline on focus */
      overflow-y: auto; /* Allow scrolling for long notes */
      background-image:
          repeating-linear-gradient(
              to bottom,
              transparent,
              transparent 1.6em, /* Line height - 0.1em margin */
              var(--note-line-color) 1.7em /* Line color */
          );
      background-position: left top;
      background-size: 100% 1.7em; /* background-sizeã‚‚è¡Œé–“ã«åˆã‚ã›ã‚‹ */
    }
    body.day-mode .memo-input {
      background-image:
          repeating-linear-gradient(
              to bottom,
              transparent,
              transparent 1.6em,
              var(--day-note-line-color) 1.7em
          );
    }

    .memo-label {
      color: var(--text-color);
      font-family: 'Roboto', sans-serif;
      font-size: 0.85em; /* æ–‡å­—ã‚’å°ã•ã */
      margin-bottom: 6px; /* ãƒãƒ¼ã‚¸ãƒ³ã‚’è©°ã‚ã‚‹ */
      display: block;
      transition: color 0.5s ease;
      text-align: center; /* Center the label above the memo */
      font-weight: bold;
    }

    /* Elements to hide/show dynamically */
    .memo-input-controls {
      text-align: center;
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    .memo-input-controls.hidden {
      opacity: 0;
      height: 0;
      overflow: hidden;
      margin-bottom: 0 !important;
      padding-top: 0 !important;
      padding-bottom: 0 !important;
    }

    /* Animations for emojis */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="night-mode">
  <div class="container">
    <div class="theme-switch-wrapper">
      <span>â˜€ï¸ Day Mode</span>
      <label class="theme-switch" for="checkbox">
        <input type="checkbox" id="checkbox" onchange="toggleTheme()" checked />
        <div class="slider round"></div>
      </label>
      <span>ğŸŒŒ Night Mode</span>
    </div>

    <h1><span style="font-size: 1.5em; animation: pulse 2s infinite;">ğŸ’¸</span> XRPã‚’å—ã‘å–ã‚‹</h1>

    <div class="streamer-info">
      <p>ã‚ãªãŸã®XRPLãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã™ã‚‹ã‹ã€ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚’æ¥ç¶šã—ã¦ãã ã•ã„ï¼š</p>
      <div class="xrpl-address-wrapper">
        <input type="text" id="streamerAddressInput" class="xrpl-address" placeholder="ä¾‹: r...abc123" />
        <button onclick="copyAddress()" class="copy-icon-button" aria-label="ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã‚³ãƒ”ãƒ¼">ğŸ“‹</button>
      </div>
      <div class="address-buttons">
        <button onclick="connectWallet()" class="connect-button">ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã«æ¥ç¶š <span style="margin-left: 5px;">ğŸš€</span></button>
      </div>
      <p id="copyStatus" class="copy-status">âœ¨ ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</p>
    </div>

    <hr>

    <div class="viewer-section">
      <h2><span style="font-size: 1.2em; animation: rotate 3s infinite linear;">ğŸ’°</span> XRPã‚’æŠ•ã’éŠ­ã—ã¦ã‚‚ã‚‰ã†</h2>
      <p>ï¼ˆã“ã®ãƒ‡ãƒ¢ã§ã¯0.1XRPå›ºå®šã§ã™ï¼‰</p>
      <div class="input-group">
        <input type="number" id="tipAmount" value="0.1" disabled> <span>XRP</span>
      </div>
      <button onclick="sendTip()" id="tipButton" class="tip-button">XRPã‚’æŠ•ã’éŠ­ã—ã¦ã‚‚ã‚‰ã† <span style="margin-left: 10px;">âœ¨</span></button>
      <p id="message" class="message"></p>
      <div id="qrCodeArea" class="qr-code-area">
        <p>ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹å ´åˆ: <br>Xamanã‚¢ãƒ—ãƒªã§QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ãã ã•ã„ã€‚</p>
        <img id="qrImage" class="qr-image" alt="QR Code">
        <p style="margin-top: 20px;">**åŒã˜æºå¸¯ã§é€é‡‘ã™ã‚‹å ´åˆ:**</p>
        <button id="openXamanButton" class="open-xaman-button">Xamanã‚¢ãƒ—ãƒªã§é–‹ã <span style="margin-left: 5px;">ğŸ“±</span></button>
      </div>
    </div>

    <hr>

    <div id="memoSection" class="memo-section">
        <h3><span style="font-size: 1.2em;">ğŸ“</span> ãƒ¡ãƒ¢æ©Ÿèƒ½</h3>
        
        <div id="memoInputControls" class="memo-input-controls">
          <p id="pinInstruction"></p>
          <div class="pin-input-group">
              <input type="password" id="pinInput" placeholder="PINã‚³ãƒ¼ãƒ‰ (4æ¡)" maxlength="4" onkeyup="checkPinInput()">
          </div>
          <p id="pinStatus" class="pin-status"></p>
          <button onclick="verifyPin()" id="verifyPinButton" class="pin-button" disabled>PINã‚’èªè¨¼</button>
        </div>

        <div id="memoInputContainer" class="memo-input-container">
            <textarea id="privateMemo" class="memo-input" placeholder="ãƒ¡ãƒ¢ã‚’å…¥åŠ›..."></textarea>
        </div>
    </div>

  </div>

  <script>
    let currentXrpUri = ''; // Global variable to store the generated XRP URI
    const LOCAL_STORAGE_PIN_KEY = 'memoPinCode'; // PINã‚’ä¿å­˜ã™ã‚‹ã‚­ãƒ¼
    const LOCAL_STORAGE_MEMO_UNLOCKED_KEY = 'memoUnlocked'; // ãƒ¡ãƒ¢ãŒã‚¢ãƒ³ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸçŠ¶æ…‹ã‚’ä¿å­˜ã™ã‚‹ã‚­ãƒ¼
    const LOCAL_STORAGE_MEMO_CONTENT_KEY = 'privateMemoContent'; // ãƒ¡ãƒ¢ã®å†…å®¹ã‚’ä¿å­˜ã™ã‚‹ã‚­ãƒ¼

    let storedPin = null; // ãƒ‡ãƒã‚¤ã‚¹ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹PIN
    let inactivityTimer; // ã‚¹ãƒªãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ï¼ˆéã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰ã‚’æ¤œå‡ºã™ã‚‹ã‚¿ã‚¤ãƒãƒ¼
    const INACTIVITY_TIMEOUT = 5 * 60 * 1000; // 5åˆ† (ãƒŸãƒªç§’)

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('streamerAddressInput').value = '';
      // Set initial theme based on local storage or default to night mode
      const savedTheme = localStorage.getItem('theme') || 'night-mode';
      document.body.className = savedTheme;
      document.getElementById('checkbox').checked = (savedTheme === 'night-mode');

      // ãƒ¡ãƒ¢æ©Ÿèƒ½ã®åˆæœŸçŠ¶æ…‹ã‚’è¨­å®š
      initializeMemoSection();
      
      // Load saved memo
      const savedMemo = localStorage.getItem(LOCAL_STORAGE_MEMO_CONTENT_KEY);
      if (savedMemo) {
          document.getElementById('privateMemo').value = savedMemo;
      }
      // Save memo on input change
      document.getElementById('privateMemo').addEventListener('input', (event) => {
          localStorage.setItem(LOCAL_STORAGE_MEMO_CONTENT_KEY, event.target.value);
      });

      // Event listener for the "Open in Xaman" button
      document.getElementById('openXamanButton').addEventListener('click', () => {
          if (currentXrpUri) {
              window.location.href = currentXrpUri; // Attempt to open the Xaman app via deep link
          } else {
              alert('ã¾ãšæŠ•ã’éŠ­ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦é€é‡‘ãƒªãƒ³ã‚¯ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚');
          }
      });

      // ã‚¹ãƒªãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰æ¤œå‡ºã®ãŸã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
      document.addEventListener('visibilitychange', handleVisibilityChange);
      document.addEventListener('mousemove', resetInactivityTimer);
      document.addEventListener('keydown', resetInactivityTimer);
      document.addEventListener('click', resetInactivityTimer);
      document.addEventListener('scroll', resetInactivityTimer); // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚‚ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã¨ã—ã¦è¿½åŠ 
      document.addEventListener('touchstart', resetInactivityTimer); // ãƒ¢ãƒã‚¤ãƒ«å‘ã‘ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆ
      resetInactivityTimer(); // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚‚ã‚¿ã‚¤ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
    });

    // ã‚¹ãƒªãƒ¼ãƒ—ãƒ¢ãƒ¼ãƒ‰ï¼ˆéã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰æ¤œå‡ºã®ãŸã‚ã®å‡¦ç†
    function resetInactivityTimer() {
        clearTimeout(inactivityTimer);
        inactivityTimer = setTimeout(lockMemoSection, INACTIVITY_TIMEOUT);
    }

    function handleVisibilityChange() {
        if (document.hidden) {
            // ã‚¿ãƒ–ãŒéã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã£ãŸå ´åˆã€ã™ãã«ãƒ­ãƒƒã‚¯
            lockMemoSection();
        } else {
            // ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«æˆ»ã£ãŸå ´åˆã€ã‚¿ã‚¤ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
            resetInactivityTimer();
        }
    }

    function lockMemoSection() {
        // ãƒ¡ãƒ¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„å ´åˆã®ã¿ãƒ­ãƒƒã‚¯å‡¦ç†ã‚’è¡Œã†
        if (localStorage.getItem(LOCAL_STORAGE_MEMO_UNLOCKED_KEY) === 'true') {
            localStorage.setItem(LOCAL_STORAGE_MEMO_UNLOCKED_KEY, 'false'); // ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã«è¨­å®š
            document.getElementById('memoInputContainer').classList.remove('show'); // ãƒ¡ãƒ¢å…¥åŠ›æ¬„ã‚’éš ã™
            document.getElementById('memoInputControls').classList.remove('hidden'); // PINå…¥åŠ›æ¬„ã‚’è¡¨ç¤º
            document.getElementById('pinInput').value = ''; // PINå…¥åŠ›ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('pinInput').focus(); // PINå…¥åŠ›ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
            document.getElementById('pinInstruction').textContent = 'ãƒ¡ãƒ¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯PINã‚³ãƒ¼ãƒ‰ã‚’å†å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
            document.getElementById('pinStatus').textContent = '';
            document.getElementById('verifyPinButton').disabled = true;
            // ã‚¢ãƒ©ãƒ¼ãƒˆã¯åˆå›ã®ãƒ­ãƒƒã‚¯æ™‚ã®ã¿è¡¨ç¤ºã—ã€ä»¥é™ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®ã¿
            console.log('Memo section locked due to inactivity or visibility change.');
        }
    }


    function toggleTheme() {
      const body = document.body;
      if (body.classList.contains('day-mode')) {
        body.classList.remove('day-mode');
        body.classList.add('night-mode');
        localStorage.setItem('theme', 'night-mode');
      } else {
        body.classList.remove('night-mode');
        body.classList.add('day-mode');
        localStorage.setItem('theme', 'day-mode');
      }
    }

    async function copyAddress() {
      try {
        const address = document.getElementById('streamerAddressInput').value;
        if (!address) {
          alert('ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
          return;
        }
        await navigator.clipboard.writeText(address);
        const copyStatus = document.getElementById('copyStatus');
        copyStatus.classList.add('show');
        setTimeout(() => {
          copyStatus.classList.remove('show');
        }, 2000);
      } catch (err) {
        console.error('ã‚³ãƒ”ãƒ¼å¤±æ•—:', err);
        alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
      }
    }

    function isValidXrplAddress(address) {
      return /^r[1-9A-HJ-NP-Za-km-z]{25,34}$/.test(address);
    }

    async function sendTip() {
      const tipButton = document.getElementById('tipButton');
      const messageElement = document.getElementById('message');
      const qrCodeArea = document.getElementById('qrCodeArea');
      const qrImage = document.getElementById('qrImage');
      const address = document.getElementById('streamerAddressInput').value.trim();

      if (!isValidXrplAddress(address)) {
        // ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒãªã„å ´åˆã¯è‡ªå‹•çš„ã«Xamanæ¥ç¶šã¸èª˜å°
        if (address === '') {
            connectWallet(); // ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒãªã„å ´åˆã¯Xamanã‚¢ãƒ—ãƒªã«æ¥ç¶šã‚’è©¦ã¿ã‚‹
            return;
        }
        alert('æ­£ã—ã„XRPLã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      currentXrpUri = `https://xrp.to/?to=${encodeURIComponent(address)}&amount=0.1`; // Store the URI
      const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(currentXrpUri)}`;

      tipButton.disabled = true;
      messageElement.textContent = 'ğŸŒŒ QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆä¸­ã§ã™...';
      messageElement.className = 'message info';
      qrCodeArea.classList.remove('show');
      
      qrImage.src = qrUrl;
      
      // QRã‚³ãƒ¼ãƒ‰ã®ãƒ­ãƒ¼ãƒ‰ãŒå®Œäº†ã—ã¦ã‹ã‚‰è¡¨ç¤ºã™ã‚‹
      qrImage.onload = () => {
        qrCodeArea.style.display = 'block';
        setTimeout(() => {
            qrCodeArea.classList.add('show');
        }, 50); 
        messageElement.textContent = 'âœ… æŠ•ã’éŠ­æº–å‚™ãŒå®Œäº†ã—ã¾ã—ãŸï¼QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã™ã‚‹ã‹ã€Xamanã‚¢ãƒ—ãƒªã§é–‹ã„ã¦ãã ã•ã„ã€‚';
        messageElement.className = 'message success';
        tipButton.disabled = false;
      };
      // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
      qrImage.onerror = () => {
        messageElement.textContent = 'âŒ QRã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
        messageElement.className = 'message error'; // ã‚¨ãƒ©ãƒ¼ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒã‚ã‚Œã°
        tipButton.disabled = false;
      };
    }

    // ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ¥ç¶šæ©Ÿèƒ½ï¼ˆXamanå¯¾å¿œï¼‰
    async function connectWallet() {
        const userAgent = navigator.userAgent || navigator.vendor || window.opera;
        const isIOS = /iPad|iPhone|iPod/.test(userAgent) && !window.MSStream;
        const isAndroid = /android/i.test(userAgent);

        if (isIOS || isAndroid) {
            // ãƒ¢ãƒã‚¤ãƒ«ç«¯æœ«ã®å ´åˆã®å‡¦ç†
            const xamanDeepLink = 'xaman://'; // Xamanã‚¢ãƒ—ãƒªã‚’é–‹ããƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯
            const appStoreLink = 'https://apps.apple.com/jp/app/xaman-wallet/id1492302343';
            const playStoreLink = 'https://play.google.com/store/apps/details?id=com.xrpllabs.xumm';

            // Xamanã‚¢ãƒ—ãƒªã¸ã®ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯ã‚’è©¦ã¿ã‚‹
            window.location.href = xamanDeepLink;

            // ã‚¢ãƒ—ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆã‚¹ãƒˆã‚¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰
            const timeout = setTimeout(() => {
                if (isIOS) {
                    window.location.href = appStoreLink;
                } else if (isAndroid) {
                    window.location.href = playStoreLink;
                }
            }, 1500); // 1.5ç§’å¾…ã£ã¦ã‹ã‚‰ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚’è©¦ã¿ã‚‹

            alert("Xamanã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã‚ˆã†ã¨ã—ã¦ã„ã¾ã™ã€‚ã‚‚ã—ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ãªã„å ´åˆã¯ã€æ•°ç§’å¾Œã«ã‚¹ãƒˆã‚¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™ã€‚");

        } else {
            // PCã®å ´åˆã®å‡¦ç†
            // Xamanã¯ä¸»ã«ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã§ã‚ã‚‹ãŸã‚ã€PCãƒ–ãƒ©ã‚¦ã‚¶ã®æ‹¡å¼µæ©Ÿèƒ½ã¯ä¸€èˆ¬çš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
            if (window.xrpl) { // XRPL.jsã®ã‚ˆã†ãªãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã®æ¤œå‡º
                try {
                    const result = await window.xrpl.request({
                        command: "account_info",
                        account: null
                    });
                    const address = result.account_data?.Account;
                    if (address) {
                        document.getElementById("streamerAddressInput").value = address;
                        alert("ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã«æ¥ç¶šã—ã¾ã—ãŸï¼");
                    } else {
                        alert("ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                    }
                } catch (error) {
                    console.error("ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ¥ç¶šã‚¨ãƒ©ãƒ¼:", error);
                    alert("ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚Xamanä»¥å¤–ã®XRPLãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                }
            } else {
                alert("Xamanã¯ä¸»ã«ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªã§ã™ã€‚PCãƒ–ãƒ©ã‚¦ã‚¶ã§ç›´æ¥ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã«æ¥ç¶šã™ã‚‹æ‹¡å¼µæ©Ÿèƒ½ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã§ã“ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ãã€ã€Œã‚¦ã‚©ãƒ¬ãƒƒãƒˆã«æ¥ç¶šã€ã¾ãŸã¯ã€ŒXamanã‚¢ãƒ—ãƒªã§é–‹ãã€ãƒœã‚¿ãƒ³ã‚’ã”åˆ©ç”¨ã„ãŸã ãã‹ã€ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ‰‹å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
            }
        }
    }

    // --- PIN and Memo Functions ---

    function initializeMemoSection() {
        const memoUnlocked = localStorage.getItem(LOCAL_STORAGE_MEMO_UNLOCKED_KEY) === 'true';
        const pinInput = document.getElementById('pinInput');
        const pinInstruction = document.getElementById('pinInstruction');
        const memoInputContainer = document.getElementById('memoInputContainer');
        const memoInputControls = document.getElementById('memoInputControls');

        storedPin = localStorage.getItem(LOCAL_STORAGE_PIN_KEY);

        document.getElementById('memoSection').classList.add('show'); // ãƒ¡ãƒ¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¸¸ã«è¡¨ç¤º

        if (memoUnlocked && storedPin) {
            // PINãŒèªè¨¼æ¸ˆã¿ã§PINãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹å ´åˆï¼ˆãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å¾Œã‚‚ãƒ¡ãƒ¢ã‚’è¡¨ç¤ºï¼‰
            pinInstruction.textContent = 'ãƒ¡ãƒ¢ã«ã‚¢ã‚¯ã‚»ã‚¹æ¸ˆã¿ã§ã™ã€‚';
            memoInputControls.classList.add('hidden'); // PINå…¥åŠ›é–¢é€£ã‚’éš ã™
            memoInputContainer.classList.add('show'); // ãƒ¡ãƒ¢å…¥åŠ›æ¬„ã‚’è¡¨ç¤º
        } else if (storedPin) {
            // PINã¯è¨­å®šæ¸ˆã¿ã ãŒæœªèªè¨¼ã®å ´åˆï¼ˆãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥å¾Œã‚„éã‚¢ã‚¯ãƒ†ã‚£ãƒ–å¾Œã«ã“ã“ã«ãã‚‹ï¼‰
            pinInstruction.textContent = 'ãƒ¡ãƒ¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯PINã‚³ãƒ¼ãƒ‰ã‚’å†å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
            memoInputControls.classList.remove('hidden'); // PINå…¥åŠ›é–¢é€£ã‚’è¡¨ç¤º
            memoInputContainer.classList.remove('show'); // ãƒ¡ãƒ¢å…¥åŠ›æ¬„ã‚’éš ã™
        } else {
            // PINãŒã¾ã è¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆï¼ˆåˆå›ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
            pinInstruction.textContent = 'ãƒ¡ãƒ¢ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®PINã‚³ãƒ¼ãƒ‰ã‚’4æ¡ã§è¨­å®šã—ã¦ãã ã•ã„ã€‚';
            memoInputControls.classList.remove('hidden'); // PINå…¥åŠ›é–¢é€£ã‚’è¡¨ç¤º
            memoInputContainer.classList.remove('show'); // ãƒ¡ãƒ¢å…¥åŠ›æ¬„ã‚’éš ã™
        }
        pinInput.value = ''; // PINå…¥åŠ›ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãŠã
        checkPinInput(); // åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚ã«ã‚‚ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹ã‚’ãƒã‚§ãƒƒã‚¯
    }

    function checkPinInput() {
        const pinInput = document.getElementById('pinInput');
        const verifyButton = document.getElementById('verifyPinButton');
        const pinStatus = document.getElementById('pinStatus');

        if (pinInput.value.length === 4) {
            verifyButton.disabled = false;
        } else {
            verifyButton.disabled = true;
        }

        // å…¥åŠ›ä¸­ã®ãƒ’ãƒ³ãƒˆ
        if (pinInput.value.length > 0 && pinInput.value.length < 4) {
            pinStatus.textContent = 'PINã‚³ãƒ¼ãƒ‰ã¯4æ¡ã§ã™ã€‚';
            pinStatus.style.color = 'var(--text-color)';
        } else {
            pinStatus.textContent = '';
        }
    }

    function verifyPin() {
        const enteredPin = document.getElementById('pinInput').value;
        const pinStatus = document.getElementById('pinStatus');
        const memoInputContainer = document.getElementById('memoInputContainer');
        const pinInstruction = document.getElementById('pinInstruction');
        const pinInput = document.getElementById('pinInput');
        const verifyPinButton = document.getElementById('verifyPinButton');
        const memoInputControls = document.getElementById('memoInputControls');


        if (!storedPin) {
            // åˆå›è¨­å®šæ™‚
            localStorage.setItem(LOCAL_STORAGE_PIN_KEY, enteredPin);
            storedPin = enteredPin;
            localStorage.setItem(LOCAL_STORAGE_MEMO_UNLOCKED_KEY, 'true'); // åˆå›è¨­å®šæ™‚ã¯å³ã‚¢ãƒ³ãƒ­ãƒƒã‚¯
            pinStatus.textContent = 'æ–°ã—ã„PINã‚³ãƒ¼ãƒ‰ãŒè¨­å®šã•ã‚Œã¾ã—ãŸï¼';
            pinStatus.style.color = 'var(--success-color)';
            
            memoInputControls.classList.add('hidden'); // PINå…¥åŠ›é–¢é€£ã‚’éš ã™
            memoInputContainer.classList.add('show'); // ãƒ¡ãƒ¢å…¥åŠ›æ¬„ã‚’è¡¨ç¤º
            pinInput.value = ''; // PINå…¥åŠ›ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('privateMemo').focus(); // ãƒ¡ãƒ¢å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
            resetInactivityTimer(); // ãƒ¡ãƒ¢é–‹ã„ãŸã‚‰ã‚¿ã‚¤ãƒãƒ¼ãƒªã‚»ãƒƒãƒˆ
        } else {
            // æ—¢å­˜PINã¨ã®æ¯”è¼ƒ
            if (enteredPin === storedPin) {
                localStorage.setItem(LOCAL_STORAGE_MEMO_UNLOCKED_KEY, 'true');
                pinStatus.textContent = 'PINã‚³ãƒ¼ãƒ‰ãŒèªè¨¼ã•ã‚Œã¾ã—ãŸï¼';
                pinStatus.style.color = 'var(--success-color)';
                
                memoInputControls.classList.add('hidden'); // PINå…¥åŠ›é–¢é€£ã‚’éš ã™
                memoInputContainer.classList.add('show'); // ãƒ¡ãƒ¢å…¥åŠ›æ¬„ã‚’è¡¨ç¤º
                pinInput.value = ''; // PINå…¥åŠ›ã‚’ã‚¯ãƒªã‚¢
                document.getElementById('privateMemo').focus(); // ãƒ¡ãƒ¢å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
                resetInactivityTimer(); // ãƒ¡ãƒ¢é–‹ã„ãŸã‚‰ã‚¿ã‚¤ãƒãƒ¼ãƒªã‚»ãƒƒãƒˆ
            } else {
                localStorage.setItem(LOCAL_STORAGE_MEMO_UNLOCKED_KEY, 'false'); // èªè¨¼å¤±æ•—
                pinStatus.textContent = 'PINã‚³ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
                pinStatus.style.color = 'var(--accent-color-2)';
                memoInputContainer.classList.remove('show'); // ãƒ¡ãƒ¢å…¥åŠ›æ¬„ã‚’éš ã™
                pinInput.value = ''; // PINå…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆ
                verifyPinButton.disabled = true;
            }
        }
    }
  </script>
</body>
</html>
